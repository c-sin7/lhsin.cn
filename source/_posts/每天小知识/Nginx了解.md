---
title: Nginx了解
author: sin
categories: 小知识
summary: Nginx了解
tags: 
  - Nginx
---

# Nginx了解

## 1. 什么是Nginx?

​		*Nginx* (engine x) 是一个高性能的[HTTP](https://baike.baidu.com/item/HTTP)和[反向代理](https://baike.baidu.com/item/反向代理/7793488)web服务器，同时也提供了IMAP/POP3/SMTP服务。

​		Nginx的特点是占有内存少，[并发](https://baike.baidu.com/item/并发/11024806)能力强，能够支持高达 50,000 个并发连接数的响应，事实上nginx的并发能力在同类型的网页服务器中表现较好，中国大陆使用nginx网站用户有：百度、[京东](https://baike.baidu.com/item/京东/210931)、[新浪](https://baike.baidu.com/item/新浪/125692)、[网易](https://baike.baidu.com/item/网易/185754)、[腾讯](https://baike.baidu.com/item/腾讯/112204)、[淘宝](https://baike.baidu.com/item/淘宝/145661)等。

​		Nginx支持正向代理、反向代理、负载均衡和动静分离。接下来一一介绍。

## 1.1 正向代理

​		在如今的网络环境下，我们如果由于技术需要要去访问国外的某些网站，此时你会发现位于国外的某网站我们通过浏览器是没有办法访问的，此时大家可能都会用一个**代理(vpn)**进行访问，代理的方式主要是找到一个可以访问国外网站的代理服务器，我们将请求发送给代理服务器，代理服务器去访问国外的网站，然后将访问到的数据传递给我们！

​		Nginx支持正向代理，"它代理的是客户端"，是一个位于客户端和原始服务器(origin server)之间的服务器，为了从原始服务器取得内容，客户端向代理发送一个请求并指定目标(原始服务器)，然后代理向原始服务器转交请求并将获得的内容返回给客户端。客户端必须要进行一些特别的设置才能使用正向代理。

<img src="https://raw.githubusercontent.com/c-sin7/picgoIMG/main/image-20230302110036503.png" alt="image-20230302110036503"  />

客户端必须设置正向代理服务器，当然前提是要知道正向代理服务器的IP地址，还有代理程序的端口。如图。

![img](https://raw.githubusercontent.com/c-sin7/picgoIMG/main/1614601035172-eea2a1ad-7f1b-4b53-8dd8-a6f8578d95b8.png)

**正向代理的用途：**

（1）访问原来无法访问的资源，如Google

（2） 可以做缓存，加速访问资源

（3）对客户端访问授权，上网进行认证

（4）代理可以记录用户访问记录（上网行为管理），对外隐藏用户信息

## 1.2 反向代理

​		关于反向代理的处理方式，举例淘宝网站，每天同时连接到网站的访问人数已经爆表，单个服务器远远不能满足人民日益增长的购买欲望了，此时就出现了一个大家耳熟能详的名词：分布式部署；也就是通过部署多台服务器来解决访问人数限制的问题；淘宝网站中大部分功能也是直接使用Nginx进行反向代理实现的，并且通过封装Nginx和其他的组件之后起了个高大上的名字：Tengine，有兴趣的童鞋可以访问Tengine的官网查看具体的信息：http://tengine.taobao.org/。

> Tengine是一个由淘宝网发起的Web服务器开源项目，其核心成员来自于[淘宝](http://www.taobao.com/) 、[搜狗](http://www.sogou.com/) 等互联网企业。它在[Nginx](http://nginx.org/) 的基础上，针对大访问量网站的需求，添加了很多高级功能和特性。Tengine的性能和稳定性已经在大型的网站如[淘宝网](http://www.taobao.com/) ，[天猫商城](http://www.tmall.com/) 等得到了很好的检验。它的最终目标是打造一个高效、稳定、安全、易用的Web平台。
>

​		Nginx支持反向代理，"它代理的是服务端，代服务端接收请求"，主要用于服务器集群分布式部署的情况下，反向代理隐藏了服务器的信息。多个客户端给服务器发送的请求，**Nginx服务器接收到之后，按照一定的规则分发给了后端的业务处理服务器进行处理**了。请求的来源也就是客户端是明确的，但是请求具体由哪台服务器处理的并不明确了，Nginx扮演的就是一个反向代理角色。

![img](https://raw.githubusercontent.com/c-sin7/picgoIMG/main/1614601035335-708a9d56-29ed-4ed8-9fa3-8604758f20e0.png)



**反向代理的作用：**

（1）保证内网的安全，通常将反向代理作为公网访问地址，Web服务器是内网。

（2）负载均衡，通过反向代理服务器来优化网站的负载

## 1.3 正向代理与反向代理的应用场景

通常情况下，我们在实际项目操作时，正向代理和反向代理很有可能会存在在一个应用场景中，**正向代理代理客户端的请求去访问目标服务器，目标服务器是一个反向代理服务器，反向代理了多台真实的业务处理服务器。**具体的拓扑图如下：

![img](https://raw.githubusercontent.com/c-sin7/picgoIMG/main/1614601035276-64a46660-e97c-4186-aba2-c9d533a28a87.png)



## 1.4 正向代理与反向代理的区别

通过一张图来说明正向代理和反向代理二者之间的区别：



![img](https://raw.githubusercontent.com/c-sin7/picgoIMG/main/1614601035284-7676d4e1-1895-4435-b3a2-3ab1c9195c7d.png)



**图解：**

在正向代理中，Proxy和Client 同属于一个LAN（图中方框内），隐藏了客户端信息；

在反向代理中，Proxy和Server同属于一个LAN（图中方框内），隐藏了服务端信息；

实际上，Proxy在两种代理中做的事情都是替服务器代为收发请求和响应，不过从结构上看正好左右互换了一下，所以把后出现的那种代理方式称为反向代理了。

## 1.5 负载均衡

当**Nginx扮演了反向代理服务器的角色**，它是以依据什么样的规则进行请求分发的呢？不用的项目应用场景，分发的规则是否可以控制呢？

我们把客户端发送的、Nginx反向代理服务器接收到的请求数量，就是我们说的负载量。

请求数量按照一定的规则进行分发到不同的服务器处理的规则，就是一种均衡规则。

将服务器接收到的请求按照规则分发的过程，称为负载均衡。

负载均衡在实际项目操作过程中，有**硬件负载均衡和软件负载均衡**两种，硬件负载均衡也称为硬负载，如F5负载均衡，相对造价昂贵成本较高，但是数据的稳定性安全性等等有非常好的保障，如中国移动中国联通这样的公司才会选择硬负载进行操作；更多的公司考虑到成本原因，会选择使用软件负载均衡，软件负载均衡是利用现有的技术结合主机硬件实现的一种消息队列分发机制。

![img](https://raw.githubusercontent.com/c-sin7/picgoIMG/main/1614601035715-45ff166b-1cd0-497c-92f2-43fc237fed5f.png)



**Nginx支持的负载均衡调度算法方式如下：**

1. **weight轮询**（默认，常用，具有HA功效！）：接收到的请求按照权重分配到不同的后端服务器，即使在使用过程中，某一台后端服务器宕机，Nginx会自动将该服务器剔除出队列，请求受理情况不会受到任何影响。 这种方式下，可以给不同的后端服务器设置一个权重值(weight)，用于调整不同的服务器上请求的分配率；权重数据越大，被分配到请求的几率越大；该权重值，主要是针对实际工作环境中不同的后端服务器硬件配置进行调整的。
2. **ip_hash**（常用）：每个请求按访问ip的hash结果分配，这样每个访客固定访问一个后端服务器，这也在一定程度上解决了集群部署环境下**session共享**的问题。
3. **fair**：智能调整调度算法，动态的根据后端服务器的请求处理到响应的时间进行均衡分配，响应时间短处理效率高的服务器分配到请求的概率高，响应时间长处理效率低的服务器分配到的请求少；结合了前两者的优点的一种调度算法。但是需要注意的是Nginx默认不支持fair算法，如果要使用这种调度算法，请安装upstream_fair模块。
4. **url_hash**：按照访问的url的hash结果分配请求，每个请求的url会指向后端固定的某个服务器，可以在Nginx作为静态服务器的情况下提高缓存效率。同样要注意Nginx默认不支持这种调度算法，要使用的话需要安装Nginx的hash软件包。

## 1.6 动静分离

​		为了提高网站的响应速度，减轻程序服务器（Tomcat，Jboss等）的负载，**对于静态资源比如图片，js，css等文件，我们可以在Nginx反向代理服务器中进行缓存，这样浏览器在请求一个静态资源时，Nginx代理服务器就可以直接处理，而不用将请求转发给后端服务器。**用户请求的动态文件比如servlet，jsp则转发给Tomcat，Jboss服务器处理，这就是动静分离。

![img](https://raw.githubusercontent.com/c-sin7/picgoIMG/main/1614601035199-3b5a8b4d-d447-4de8-a9f8-5ad24efd64be.png)



## 1.7 几种常用web服务器对比

| **对比项\服务器** | **Apache** | **Nginx** | **Lighttpd** |
| ----------------- | ---------- | --------- | ------------ |
| Proxy代理         | 非常好     | 非常好    | 一般         |
| Rewriter          | 好         | 非常好    | 一般         |
| Fcgi              | 不好       | 好        | 非常好       |
| 热部署            | 不支持     | 支持      | 不支持       |
| 系统压力          | 很大       | 很小      | 比较小       |
| 稳定性            | 好         | 非常好    | 不好         |
| 安全性            | 好         | 一般      | 一般         |
| 静态文件处理      | 一般       | 非常好    | 好           |
| 反向代理          | 一般       | 非常好    | 一般         |

## 2. Linux安装Nginx

> 关于Nginx的依赖说明：https://www.jianshu.com/p/14c81fbcb401