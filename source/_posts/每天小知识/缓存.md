---
title: 缓存
author: sin
categories: 小知识
summary: 缓存是将请求结果存储在与原始存储位置或临时存储位置不同位置的过程，可以避免重复执行相同操作。
tags: 
  - 缓存
---

缓存是将==请求的结果==存储在与**原始存储位置**或**临时存储位置**不同的位置的过程，可以避免重复执行相同的操作。
基本上，缓存是文件和数据的==临时存储==，从这个新位置访问数据会更快。

## 例子

 - Web浏览器缓存HTML、CSS、JS和图像，以便在再次请求时更快的访问网站。 
 - ==CDN存储静态文件==，有助于减少延迟。
 - DNS用于获取查询的IP地址，查询结果可以存储在缓存中，因此当我们多次请求IP地址时，==不必再次执行DNS查询==，从而可以更快的访问网页。
## 回收机制（Eviction policy）
当缓存用完时，需要删除旧缓存项，从而可以缓存新内容。事实上，删除最近最少使用的对象是最流行的方法之一，这个解决方案可以优化缓存中命中请求资源的概率。
- **随机替换（RR，Random Replacement）**：正如其字面意思，我们可以随机删除一个条目。
- **最少使用次数（LFU，Least frequently used）**：记录一个条目被请求的频率，并删除最不频繁使用的条目。
- **最近最少使用（LRU，Least Recently Used）**：在LRU中，删除最近使用次数最少的条目。
- **先入先出（FIFO，First In First Out）**：FIFO算法保存对象加载到缓存中的顺序。如果缓存没有命中，从头部取出一个或多个对象，并将一个新的缓存对象插入到队尾。如果缓存命中，保持缓存不变。

## 不同的缓存方法

 1. **应用服务器缓存（Application server cache）**：我们可以==直接在应用层==缓存数据。每次向服务发出请求时，如果存在缓存的本地数据，可以快速返回。如果不在缓存中，将从数据库查询数据。
 2. **全局缓存（Global caches）**：在全局缓存中，==所有节点使用相同的单一缓存空间==，每个应用节点以与本地节点相同的方式查询缓存。
 3. **分布式缓存（Distributed cache）**：通常使用==一致性哈希算法==分割缓存数据，==每个节点都拥有部分缓存数据==。如果请求节点正在搜索某一段数据，那么可以很容易的使用哈希函数从分布式缓存中定位信息，以确定数据是否可用。
 4. **内容分发网络（CDN，Content Distribution Network）**:如果我们正在开发的框架还没有大到足以拥有自己的CDN，而我们的页面又需要大量静态媒体，那么租用CDN是最好的选择。使用像apache这样的轻量级HTTP服务器，可以为不同的子域（如“blog.enjoyalgorithms.com”）提供静态媒体服务，并将DNS从我们的服务器切到CDN层。
 5. **客户端缓存（Client-Side Caches）**：客户端缓存直接在浏览器或其他客户端（例如中间网络缓存）中缓存以前请求的文件数据。
 6. **ISP层缓存（ISP layer cache）**:ISP缓存的工作方式与浏览器缓存基本相同。一旦你访问了一个网站，你的ISP可能会缓存这些页面，这样当你下次访问它们时，加载速度会更快。这样做的主要问题是，与浏览器缓存不同，你不能删除这些临时文件，必须等待ISP的缓存过期才能请求文件的新副本。

## 缓存失效（Cache Invalidation）
如果数据库中的数据被更改，它在缓存中应该是无效的，否则可能会触发不一致的应用程序操作。当前主要有三种缓存系统设计方案：

 1. **Write through cache**：通过缓存执行写操作，只有当写DB和缓存都成功时，写操作才被验证为成功。在缓存和存储之间，将拥有完全的数据一致性。在崩溃、电源故障或其他系统干扰的情况下，任何东西都不会丢失。然而，在这种情况下，因为要写入两个不同的系统，写入延迟会更高。
 2. **Write around cache**：写操作绕过缓存，直接写入DB。在缓存读取过程中，由于数据不在缓存中，cache miss会增加，缓存设备需要从数据库中读取信息。因此，在快速写入和重新读取数据的应用程序中，这可能会导致更高的读延迟。
 3. **Write back cache**：写操作直接发送给缓存层，一旦缓存的写操作完成，就认为写操作成功。然后缓存异步的将写操作同步到DB。对于写密集型应用，这可以降低写延迟以及提高写吞吐量。但是，因为缓存是写入数据的唯一副本，如果缓存层被关闭，有可能丢失数据。通过在缓存中部署多个可以识别写操作的副本，我们可以尽量减少数据丢失的风险。


# 缓存的好处

 1. **提高应用程序性能**—缓存可以用来==提高系统性能和降低API延迟==。
 2. **降低数据库成本**——缓存会占用缓存服务器的额外流量，从而==减少数据库流量==，最终降低数据库成本。
 3. **减轻后端负载**——将相同的请求流量从主服务器卸载到缓存服务器将减轻后端负载。
 4. **增加读吞吐量(IOPS)**——缓存服务器对缓存数据的响应比主服务器快得多，这增加了读吞吐量。

